<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="static/images/icon.png" type="image/png" sizes="168x168">
  <title>Consultium AI - Professional Medical Documentation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Custom styles */
    * { font-family: 'Inter', sans-serif; }
    
    /* Loading overlay */
    #loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      backdrop-filter: blur(4px);
    }
    
    .spinner {
      border: 3px solid #e5e7eb;
      border-top-color: #3b82f6;
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Professional gradient backgrounds */
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .blue-gradient {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
    }
    
    /* Card hover effects */
    .hover-lift {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .hover-lift:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Feature cards */
    .feature-card {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
    }
    
    .feature-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    /* Coming Soon cards */
    .coming-soon-card {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      border: 2px dashed #cbd5e1;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .coming-soon-card:hover {
      transform: translateY(-2px);
      border-color: #94a3b8;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    .coming-soon-badge {
      position: absolute;
      top: 10px;
      right: -25px;
      background: linear-gradient(45deg, #3b82f6, #06b6d4);
      color: white;
      padding: 6px 35px;
      font-size: 0.7rem;
      font-weight: 700;
      transform: rotate(35deg);
      box-shadow: 0 3px 6px rgba(0,0,0,0.3);
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    
    .coming-soon-content {
      filter: grayscale(0.3);
      opacity: 0.8;
    }
    
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes pulse-glow {
      from {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      to {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 0 20px rgba(59, 130, 246, 0.3);
      }
    }
    
    .lamp-pulse {
      animation: lamp-pulse 1.5s ease-in-out infinite alternate;
    }
    
    @keyframes lamp-pulse {
      from {
        box-shadow: 0 0 5px rgba(251, 191, 36, 0.5);
      }
      to {
        box-shadow: 0 0 15px rgba(251, 191, 36, 0.8);
      }
    }
    
    /* Chat styles */
    .chat-container {
      max-height: 400px;
      overflow-y: auto;
    }
    
         .chat-message {
       margin-bottom: 1rem;
       padding: 0.75rem 1rem;
       border-radius: 1rem;
       max-width: 80%;
       word-wrap: break-word;
     }
     
     .user-message {
       background: #3b82f6;
       color: white;
       margin-left: auto;
       border-bottom-right-radius: 0.25rem;
     }
     
     .ai-message {
       background: #f3f4f6;
       color: #374151;
       margin-right: auto;
       border-bottom-left-radius: 0.25rem;
     }
     
     .ai-message a {
       color: #2563eb;
       text-decoration: underline;
     }
     
     .ai-message a:hover {
       color: #1d4ed8;
     }
     
     .ai-message ul {
       margin: 0.5rem 0;
       padding-left: 1rem;
     }
     
     .ai-message li {
       margin-bottom: 0.25rem;
     }
    
    /* SOEP sections */
    .soep-section {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      border: 1px solid #e5e7eb;
    }
    
    /* Recording overlay */
    .recording-overlay {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(8px);
    }
    
    /* Waveform styling */
    #waveform-canvas {
      border-radius: 1rem;
      background: rgba(59, 130, 246, 0.1);
    }
    
    /* Navigation tabs */
    .nav-tab {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
         .nav-tab.active {
       background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
       color: white;
     }
    
    .nav-tab:not(.active) {
      background: #f8fafc;
      color: #64748b;
    }
    
    .nav-tab:not(.active):hover {
      background: #e2e8f0;
      color: #475569;
    }
    
    /* Custom scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Loading overlay -->
  <div id="loading-overlay">
    <div class="text-center">
      <div class="spinner mx-auto mb-4"></div>
      <p class="text-gray-600">Verwerken...</p>
    </div>
  </div>

  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
    <div class="flex items-center space-x-3">
          <img src="static/images/logo.png" alt="Consultium AI" class="h-32 w-auto">
    </div>
        
                 <!-- Navigation -->
         <nav class="hidden md:flex space-x-8">
           <button class="nav-tab active" data-tab="dashboard">Dashboard</button>
           <button class="nav-tab" data-tab="soep">SOEP Verslag</button>
           <button class="nav-tab" data-tab="chat">AI Chat</button>
           <button class="nav-tab" data-tab="tolk">Live Tolk</button>
         </nav>
        
        <!-- Profile -->
    <div class="relative">
          <button onclick="toggleMenu()" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900">
            <img src="static/images/default.png" alt="Profiel" class="w-10 h-10 rounded-full border border-gray-300 cursor-pointer">
          </button>
          <div id="dropdown-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg z-50 border border-gray-200">
            <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-50">Account Instellingen</a>
            <a href="index.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-50">Uitloggen</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Recording Overlay -->
  <div id="recording-overlay" class="fixed inset-0 recording-overlay hidden z-50 flex flex-col items-center justify-center">
    <button id="cancel-recording-btn" class="absolute top-6 right-6 text-3xl text-gray-500 hover:text-gray-700 transition-colors">&times;</button>
    
    <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-2">Live Opname</h2>
      <p class="text-gray-600">Spreek duidelijk en wacht op de realtime transcriptie</p>
    </div>
    
    <div class="w-full max-w-4xl mb-8">
      <canvas id="waveform-canvas" class="w-full h-32"></canvas>
    </div>
    
    <button id="soep-recording-btn" class="px-8 py-4 blue-gradient text-white text-xl font-semibold rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
      SOEP Genereren
    </button>
  </div>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Dashboard Tab -->
    <div id="dashboard-tab" class="tab-content">
             <!-- Hero Section -->
       <div class="blue-gradient rounded-2xl p-8 text-white mb-8">
        <div class="max-w-3xl">
          <h1 class="text-4xl font-bold mb-4">Welkom bij Consultium AI</h1>
          <p class="text-xl mb-6 opacity-90">Revolutioneer uw medische documentatie met AI-gestuurde SOEP-verslagen en real-time transcriptie.</p>
                                <div class="flex flex-wrap gap-4">
             <button onclick="switchTab('soep')" class="px-6 py-3 bg-white text-blue-600 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
               Start SOEP Verslag
             </button>
           </div>
        </div>
      </div>

             <!-- Feature Cards -->
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
         <div class="feature-card hover-lift">
           <div class="flex items-center mb-4">
             <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
               <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
               </svg>
             </div>
             <h3 class="text-xl font-semibold text-gray-900">SOEP Verslag</h3>
           </div>
           <p class="text-gray-600 mb-4">Automatische structurering volgens NHG-richtlijnen binnen seconden.</p>
           <button onclick="switchTab('soep')" class="text-blue-600 font-medium hover:text-cyan-600">Probeer nu ‚Üí</button>
         </div>

         <div class="feature-card hover-lift">
           <div class="flex items-center mb-4">
             <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
               <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
               </svg>
             </div>
             <h3 class="text-xl font-semibold text-gray-900">Live Opname</h3>
           </div>
           <p class="text-gray-600 mb-4">Real-time transcriptie met 99% nauwkeurigheid tijdens het consult.</p>
           <button onclick="switchTab('soep')" class="text-green-600 font-medium hover:text-green-700">Start opname ‚Üí</button>
         </div>

         <div class="feature-card hover-lift">
           <div class="flex items-center mb-4">
             <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4">
               <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
               </svg>
             </div>
             <h3 class="text-xl font-semibold text-gray-900">AI Chat</h3>
           </div>
           <p class="text-gray-600 mb-4">Stel medische vragen en krijg directe, gevalideerde antwoorden.</p>
           <button onclick="switchTab('chat')" class="text-purple-600 font-medium hover:text-purple-700">Chat starten ‚Üí</button>
         </div>

         <div class="feature-card hover-lift">
           <div class="flex items-center mb-4">
             <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4">
               <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m10.5 21 5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 0 1 6-.371m0 0c1.12 0 2.233.038 3.334.114M9 5.25V3m3.334 2.364C11.176 10.658 7.69 15.08 3 17.502m9.334-12.138c.896.061 1.764.147 2.598.266m-2.598-.266C15.176 4.904 18.69.482 23 2.904"></path>
               </svg>
             </div>
             <h3 class="text-xl font-semibold text-gray-900">Live Tolk</h3>
           </div>
           <p class="text-gray-600 mb-4">Real-time vertaling tussen dokter en pati√´nt tijdens consultaties.</p>
           <button onclick="switchTab('tolk')" class="text-orange-600 font-medium hover:text-orange-700">Start vertaling ‚Üí</button>
         </div>

         <!-- Coming Soon Cards -->
         <div class="coming-soon-card pulse-glow" style="animation-delay: 0.5s;">
           <div class="coming-soon-badge">BINNENKORT</div>
           <div class="coming-soon-content">
             <div class="flex items-center mb-4">
               <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mr-4 relative">
                 <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 14.5M14.25 3.104c.251.023.501.05.75.082M19.8 14.5l-2.6 2.6a2.25 2.25 0 01-3.182 0l-2.6-2.6M19.8 14.5V16a2.25 2.25 0 01-2.25 2.25h-8.1A2.25 2.25 0 017.2 16v-1.5m12.6 0a2.25 2.25 0 012.25 2.25V19a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 19v-2.75"></path>
                 </svg>
                 <!-- Lamp Alert Icon -->
                 <div class="absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 rounded-full flex items-center justify-center lamp-pulse">
                   <svg class="w-2.5 h-2.5 text-yellow-800" fill="currentColor" viewBox="0 0 20 20">
                     <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                   </svg>
                 </div>
               </div>
               <h3 class="text-xl font-semibold text-gray-700">AI Diagnostiek</h3>
             </div>
             <p class="text-gray-500 mb-4">Intelligente ondersteuning bij het stellen van diagnoses met medische AI.</p>
             <div class="flex items-center text-gray-400 font-medium cursor-not-allowed">
               <svg class="w-4 h-4 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                 <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
               </svg>
               Wordt ontwikkeld...
             </div>
           </div>
         </div>

         <div class="coming-soon-card pulse-glow" style="animation-delay: 1s;">
           <div class="coming-soon-badge">BINNENKORT</div>
           <div class="coming-soon-content">
             <div class="flex items-center mb-4">
               <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mr-4 relative">
                 <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"></path>
                 </svg>
                 <!-- Lamp Alert Icon -->
                 <div class="absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 rounded-full flex items-center justify-center lamp-pulse">
                   <svg class="w-2.5 h-2.5 text-yellow-800" fill="currentColor" viewBox="0 0 20 20">
                     <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                   </svg>
                 </div>
               </div>
               <h3 class="text-xl font-semibold text-gray-700">Smart Recepten</h3>
             </div>
             <p class="text-gray-500 mb-4">Automatische receptgeneratie met medicatie-interactie controle.</p>
             <div class="flex items-center text-gray-400 font-medium cursor-not-allowed">
               <svg class="w-4 h-4 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                 <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
               </svg>
               Wordt ontwikkeld...
             </div>
           </div>
         </div>
       </div>

      
    </div>

    <!-- SOEP Tab -->
    <div id="soep-tab" class="tab-content hidden">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">SOEP Verslag Generator</h2>
        <p class="text-gray-600">Voer uw consultnotities in of gebruik spraakopname voor automatische SOEP-structurering</p>
      </div>

      <!-- Input Section -->
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-8">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Consultnotities</label>
          <textarea 
            id="text-input" 
            placeholder="Voer hier uw consultnotities in of gebruik de opnamefunctie..."
            class="w-full p-4 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            rows="6"
          ></textarea>
        </div>
        
        <div class="flex flex-wrap gap-4">
          <button id="whisper-btn" class="px-6 py-3 blue-gradient text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-300">
            Start Opname
          </button>
          <button id="generate-soep" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg font-semibold hover:bg-gray-200 transition-colors">
            SOEP Genereren
          </button>
        </div>
      </div>

      <!-- SOEP Results -->
      <div id="verslag-container" class="hidden">
        <h3 class="text-2xl font-bold text-gray-900 mb-6">Gegenereerd SOEP Verslag</h3>
        <div class="grid gap-6">
          <div id="s-section" class="soep-section">
            <div class="flex justify-between items-center mb-4">
              <h4 class="text-xl font-semibold text-gray-900">S - Subjectief</h4>
              <button onclick="copySection('s-content')" class="px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors">
                üìã Kopi√´ren
              </button>
            </div>
            <div id="s-content" class="text-gray-700 leading-relaxed"></div>
          </div>

          <div id="o-section" class="soep-section">
            <div class="flex justify-between items-center mb-4">
              <h4 class="text-xl font-semibold text-gray-900">O - Objectief</h4>
              <button onclick="copySection('o-content')" class="px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors">
                üìã Kopi√´ren
              </button>
            </div>
            <div id="o-content" class="text-gray-700 leading-relaxed"></div>
          </div>

          <div id="e-section" class="soep-section">
            <div class="flex justify-between items-center mb-4">
              <h4 class="text-xl font-semibold text-gray-900">E - Evaluatie</h4>
              <button onclick="copySection('e-content')" class="px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors">
                üìã Kopi√´ren
              </button>
            </div>
            <div id="e-content" class="text-gray-700 leading-relaxed"></div>
          </div>

          <div id="p-section" class="soep-section">
            <div class="flex justify-between items-center mb-4">
              <h4 class="text-xl font-semibold text-gray-900">P - Plan</h4>
              <button onclick="copySection('p-content')" class="px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors">
                üìã Kopi√´ren
              </button>
            </div>
            <div id="p-content" class="text-gray-700 leading-relaxed"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Tab -->
    <div id="chat-tab" class="tab-content hidden">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">AI Chat Assistant</h2>
        <p class="text-gray-600">Stel medische vragen en krijg direct gevalideerde antwoorden van onze AI-assistent</p>
      </div>

      <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
        <!-- Chat Header -->
        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
              <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
              </svg>
            </div>
            <div>
              <h3 class="font-semibold text-gray-900">Medische AI Assistent</h3>
              <p class="text-sm text-gray-500">Online ‚Ä¢ Klaar om te helpen</p>
            </div>
          </div>
        </div>

        <!-- Chat Messages -->
        <div id="chat-messages" class="chat-container custom-scrollbar p-6 space-y-4">
          <div class="ai-message">
            <p>üëã Hallo! Ik ben uw medische AI-assistent. Stel gerust uw vragen over diagnoses, behandelingen, medicatie of medische procedures. Hoe kan ik u vandaag helpen?</p>
          </div>
        </div>

        <!-- Chat Input -->
        <div class="border-t border-gray-200 p-4">
          <div class="flex space-x-4">
            <input 
              type="text" 
              id="chat-input" 
              placeholder="Stel uw medische vraag hier..."
              class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              onkeypress="handleChatKeyPress(event)"
            >
            <button onclick="sendChatMessage()" class="px-6 py-2 blue-gradient text-white rounded-lg font-medium hover:shadow-lg transition-all duration-300">
              Verstuur
            </button>
          </div>
        </div>
      </div>
    </div>

    

     <!-- Live Tolk Tab -->
     <div id="tolk-tab" class="tab-content hidden">
       <div class="mb-8">
         <h2 class="text-3xl font-bold text-gray-900 mb-2">Live Tolk - Intelligente Vertaling</h2>
         <p class="text-gray-600">Automatische taaldetectie en vertaling - spreek gewoon en de AI doet de rest!</p>
       </div>

       <!-- Language Selection -->
       <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-8">
         <h3 class="text-xl font-semibold text-gray-900 mb-4">Taal Instellingen</h3>
         <div class="grid md:grid-cols-2 gap-6">
           <div>
             <label class="block text-sm font-medium text-gray-700 mb-2">Taal 1 (meestal Nederlands)</label>
             <select id="language-1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
               <option value="nl">Nederlands</option>
               <option value="en">English</option>
               <option value="fr">Fran√ßais</option>
               <option value="de">Deutsch</option>
               <option value="es">Espa√±ol</option>
             </select>
           </div>
           <div>
             <label class="block text-sm font-medium text-gray-700 mb-2">Taal 2 (pati√´nt taal)</label>
             <select id="language-2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
               <option value="en">English</option>
               <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
               <option value="tr">T√ºrk√ße</option>
               <option value="pl">Polski</option>
               <option value="es">Espa√±ol</option>
               <option value="fr">Fran√ßais</option>
               <option value="de">Deutsch</option>
               <option value="it">Italiano</option>
               <option value="pt">Portugu√™s</option>
               <option value="ru">–†—É—Å—Å–∫–∏–π</option>
               <option value="zh">‰∏≠Êñá</option>
               <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
               <option value="ur">ÿßÿ±ÿØŸà</option>
             </select>
           </div>
         </div>
       </div>

       <!-- Single Recording Interface -->
       <div class="bg-white rounded-2xl p-8 shadow-sm border border-gray-200 mb-8">
         <div class="text-center mb-6">
           <div id="tolk-status" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-full text-sm inline-block mb-4">
             Klaar om te starten
           </div>
           
           <div class="mb-6">
             <button id="tolk-record-btn" class="w-24 h-24 rounded-full bg-gradient-to-r from-blue-600 to-cyan-600 text-white flex items-center justify-center hover:shadow-lg transition-all duration-300 transform hover:scale-105 mx-auto">
               <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
               </svg>
             </button>
             <p class="text-lg text-gray-600 mt-3">Klik om te spreken</p>
             <p class="text-sm text-gray-500">Live spraak-naar-spraak vertaling - spreek en luister direct</p>
           </div>
         </div>

         <!-- Language 1 (Doctor) -->
         <div class="mb-6">
           <h4 class="text-lg font-semibold text-gray-900 mb-3">Taal van arts <span id="doctor-lang-display" class="text-sm text-gray-500">(Nederlands)</span></h4>
           <div id="live-transcript" class="min-h-24 p-4 bg-gray-50 rounded-lg border border-gray-200 text-gray-700">
             <span class="text-gray-400">Gesproken woorden verschijnen hier...</span>
           </div>
         </div>

         <!-- Language 2 (Patient) -->
         <div>
           <h4 class="text-lg font-semibold text-gray-900 mb-3">Taal van pati√´nt <span id="patient-lang-display" class="text-sm text-gray-500">(English)</span></h4>
           <div id="translation-output" class="min-h-24 p-4 bg-blue-50 rounded-lg border border-blue-200 text-blue-800">
             <span class="text-blue-400">Automatische vertaling verschijnt hier...</span>
           </div>
         </div>
       </div>

       <!-- Live Conversation Display -->
       <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-8">
         <h3 class="text-xl font-semibold text-gray-900 mb-4">Live Gesprek</h3>
         <div id="tolk-conversation-history" class="space-y-4 max-h-64 overflow-y-auto custom-scrollbar">
           <div class="text-gray-500 text-center py-8">Live gesprek wordt hier weergegeven tijdens de sessie...</div>
         </div>
         <p class="text-sm text-gray-500 mt-4">Na het gesprek kunt u de samenvatting kopi√´ren naar uw HIS-systeem via SOEP verslag</p>
       </div>

       <!-- How it works -->
       <div class="bg-blue-50 rounded-2xl p-6 border border-blue-200">
         <h3 class="text-lg font-semibold text-blue-900 mb-3">Hoe werkt de Intelligente Tolk?</h3>
         <div class="grid md:grid-cols-2 gap-4 text-sm text-blue-800">
           <div class="space-y-2">
             <p><strong>1. Live gesprek:</strong> AI luistert en vertaalt in real-time</p>
             <p><strong>2. Speech-to-speech:</strong> Spreek en krijg direct gesproken antwoord</p>
             <p><strong>3. Automatische detectie:</strong> Herkent taal en vertaalt naar de andere</p>
           </div>
           <div class="space-y-2">
             <p><strong>4. Live weergave:</strong> Gesprek wordt live getoond, niet opgeslagen</p>
             <p><strong>5. SOEP integratie:</strong> Na gesprek via SOEP naar HIS-systeem</p>
             <p><strong>6. Een-klik-bediening:</strong> Simpel en intu√Øtief gebruik</p>
           </div>
         </div>
       </div>
    </div>
  </main>

  <!-- Scripts -->
  <script>
    // Tab switching functionality
    function switchTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      // Remove active class from all nav tabs
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(tabName + '-tab').classList.remove('hidden');
      
      // Add active class to selected nav tab
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    }

    // Navigation tab click handlers
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.getAttribute('data-tab');
        switchTab(tabName);
      });
    });

    // Profile dropdown toggle
    function toggleMenu() {
      document.getElementById('dropdown-menu').classList.toggle('hidden');
    }

    // Close dropdown when clicking outside
    window.addEventListener('click', e => {
      if (!e.target.closest('button') && !e.target.closest('#dropdown-menu')) {
        document.getElementById('dropdown-menu').classList.add('hidden');
      }
    });

    // Chat functionality
    function handleChatKeyPress(event) {
      if (event.key === 'Enter') {
        sendChatMessage();
      }
    }

         async function sendChatMessage() {
       const input = document.getElementById('chat-input');
       const message = input.value.trim();
       
       if (!message) return;
       
       // Add user message
       addChatMessage(message, 'user');
       input.value = '';
       
       // Show typing indicator
       const typingDiv = document.createElement('div');
       typingDiv.className = 'ai-message';
       typingDiv.innerHTML = '<p>ü§î Aan het nadenken...</p>';
       document.getElementById('chat-messages').appendChild(typingDiv);
       document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
       
       try {
         const response = await fetch('https://a2b86a9fc909.ngrok-free.app/chat-assistant', {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify({ message: message })
         });
         
         const data = await response.json();
         
         // Remove typing indicator
         typingDiv.remove();
         
         if (data.error) {
           throw new Error(data.error);
         }
         
         // Add AI response
         addChatMessage(data.reply, 'ai');
         
       } catch (error) {
         // Remove typing indicator
         typingDiv.remove();
         console.error('Chat error:', error);
         addChatMessage('Sorry, er is een fout opgetreden. Probeer het opnieuw.', 'ai');
       }
     }

         function addChatMessage(message, sender) {
       const messagesContainer = document.getElementById('chat-messages');
       const messageDiv = document.createElement('div');
       messageDiv.className = `chat-message ${sender}-message`;
       
       // Format the message with better styling
       let formattedMessage = formatChatMessage(message);
       messageDiv.innerHTML = formattedMessage;
       
       messagesContainer.appendChild(messageDiv);
       messagesContainer.scrollTop = messagesContainer.scrollHeight;
     }

     function formatChatMessage(message) {
       // Convert markdown-like formatting to HTML
       let formatted = message
         // Bold text: **text** or __text__
         .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
         .replace(/__(.*?)__/g, '<strong>$1</strong>')
         
         // Italic text: *text* or _text_
         .replace(/\*(.*?)\*/g, '<em>$1</em>')
         .replace(/_(.*?)_/g, '<em>$1</em>')
         
         // Line breaks
         .replace(/\n/g, '<br>')
         
         // Links: detect URLs and make them clickable
         .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-blue-600 hover:text-blue-800 underline">$1</a>')
         .replace(/\(([^)]+\.nl[^)]*)\)/g, '(<a href="http://$1" target="_blank" class="text-blue-600 hover:text-blue-800 underline">$1</a>)')
         
         // Bullet points: - item becomes bullet
         .replace(/^[\s]*-\s+(.+)/gm, '<li class="ml-4">$1</li>')
         
         // Numbered lists: 1. item becomes numbered
         .replace(/^[\s]*\d+\.\s+(.+)/gm, '<li class="ml-4">$1</li>');
       
       // Wrap consecutive list items in ul tags
       formatted = formatted.replace(/(<li[^>]*>.*?<\/li>)(\s*<li[^>]*>.*?<\/li>)*/g, function(match) {
         return '<ul class="list-disc ml-6 space-y-1">' + match + '</ul>';
       });
       
       // Wrap in paragraph if no other block elements
       if (!formatted.includes('<ul>') && !formatted.includes('<ol>') && !formatted.includes('<div>')) {
         formatted = '<p class="leading-relaxed">' + formatted + '</p>';
       }
       
       return formatted;
     }

    

    // SOEP Generation functionality
  async function generateSOEP() {
    const promptText = document.getElementById('text-input').value.trim();
    if (!promptText) {
        alert('Voer eerst tekst in of maak een opname.');
      return;
    }

      showLoading(true);

    try {
        const response = await fetch('https://a2b86a9fc909.ngrok-free.app/generate-soep', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: promptText })
      });
        
        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }
        
        // Populate SOEP sections
        ['s', 'o', 'e', 'p'].forEach(section => {
          const content = data[section] || 'Geen gegevens beschikbaar';
          document.getElementById(`${section}-content`).innerHTML = formatContent(content);
        });
        
        // Show results and switch to SOEP tab
      document.getElementById('verslag-container').classList.remove('hidden');
        
        // Smooth scroll to results
        setTimeout(() => {
          document.getElementById('verslag-container').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
          });
        }, 100);
        
      } catch (error) {
        console.error('Error generating SOEP:', error);
        alert('Er is een fout opgetreden bij het genereren van het SOEP-verslag. Probeer het opnieuw.');
    } finally {
        showLoading(false);
      }
    }

    function formatContent(content) {
      // Format bullet points and structure content nicely
      return content
        .replace(/\n/g, '<br>')
        .replace(/‚Ä¢\s*/g, '<br>‚Ä¢ ')
        .replace(/^<br>/, '');
    }

    function copySection(sectionId) {
      const element = document.getElementById(sectionId);
      const text = element.innerText || element.textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        // Visual feedback
        const button = element.parentElement.querySelector('button');
        const originalText = button.textContent;
        button.textContent = '‚úì Gekopieerd';
        button.classList.add('bg-green-100', 'text-green-600');
        
        setTimeout(() => {
          button.textContent = originalText;
          button.classList.remove('bg-green-100', 'text-green-600');
        }, 2000);
      }).catch(err => {
        console.error('Copy failed:', err);
        alert('Kopi√´ren mislukt. Probeer het opnieuw.');
      });
    }

    // Recording functionality
    let mediaRecorder = null;
    let audioStream = null;
    let audioChunks = [];
    let audioContext = null;
    let analyser = null;
    let animationId = null;

    

    async function startRecording() {
      try {
         // Reset cancellation flag at start
         recordingCancelled = false;
         
         audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
         audioChunks = [];
         
         const options = MediaRecorder.isTypeSupported('audio/webm') 
           ? { mimeType: 'audio/webm' } 
           : { mimeType: 'audio/mp4' };
           
         mediaRecorder = new MediaRecorder(audioStream, options);
         
         mediaRecorder.ondataavailable = event => {
           if (event.data.size > 0 && !recordingCancelled) {
             audioChunks.push(event.data);
           }
         };
         
         mediaRecorder.onstop = handleRecordingStop;
         mediaRecorder.start();
         
         // Show recording overlay
         document.getElementById('recording-overlay').classList.remove('hidden');
         document.getElementById('whisper-btn').disabled = true;
         
         // Start waveform animation
         initWaveform();
         
       } catch (error) {
         console.error('Recording error:', error);
         alert('Kon microfoon niet starten. Controleer uw browserinstellingen.');
       }
     }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
      }
      
      document.getElementById('recording-overlay').classList.add('hidden');
      document.getElementById('whisper-btn').disabled = false;
      
      stopWaveform();
    }

         let recordingCancelled = false;

     function cancelRecording() {
       recordingCancelled = true; // Set flag to prevent processing
       
       if (mediaRecorder && mediaRecorder.state === 'recording') {
         mediaRecorder.stop();
       }
       
       // Clear audio chunks to prevent processing
       audioChunks = [];
       
       document.getElementById('recording-overlay').classList.add('hidden');
       document.getElementById('whisper-btn').disabled = false;
       
       stopWaveform();
       
       if (audioStream) {
         audioStream.getTracks().forEach(track => track.stop());
       }
       
       // Reset loading overlay if it's showing
       const loader = document.getElementById('loading-overlay');
       loader.style.display = 'none';
       
       console.log('Recording cancelled by user');
     }

         async function handleRecordingStop() {
       // Check if recording was cancelled
       if (recordingCancelled) {
         console.log('Recording was cancelled, skipping processing');
         recordingCancelled = false; // Reset flag
         return;
       }
       
       if (audioChunks.length === 0) {
         console.log('No audio chunks available, skipping processing');
         return;
       }
       
       const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
       const formData = new FormData();
      formData.append('file', audioBlob, 'recording.webm');
       
       showLoading(true);
       
       try {
         const response = await fetch('https://a2b86a9fc909.ngrok-free.app/transcribe-audio', {
           method: 'POST',
           body: formData
         });
         
         const result = await response.json();
         
         if (result.error) {
           throw new Error(result.error);
         }
         
         // Set transcribed text
        document.getElementById('text-input').value = result.transcription;
         
         // Auto-generate SOEP
        await generateSOEP();
         
       } catch (error) {
         console.error('Transcription error:', error);
         alert('Fout bij transcriptie. Probeer het opnieuw.');
      } finally {
         showLoading(false);
         
         if (audioStream) {
           audioStream.getTracks().forEach(track => track.stop());
         }
         
         // Reset flag for next recording
         recordingCancelled = false;
       }
     }

    // Waveform visualization
    function initWaveform() {
      const canvas = document.getElementById('waveform-canvas');
      const ctx = canvas.getContext('2d');
      
      // Set canvas size
      const dpr = window.devicePixelRatio || 1;
      canvas.width = canvas.offsetWidth * dpr;
      canvas.height = canvas.offsetHeight * dpr;
      ctx.scale(dpr, dpr);
      
      // Initialize audio context
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 256;
      
      const source = audioContext.createMediaStreamSource(audioStream);
      source.connect(analyser);
      
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      
      function draw() {
        animationId = requestAnimationFrame(draw);
        
        analyser.getByteFrequencyData(dataArray);
        
        ctx.fillStyle = 'rgba(59, 130, 246, 0.1)';
        ctx.fillRect(0, 0, canvas.width / dpr, canvas.height / dpr);
        
        const barWidth = (canvas.width / dpr) / bufferLength * 2.5;
        let barHeight;
        let x = 0;
        
        for (let i = 0; i < bufferLength; i++) {
          barHeight = (dataArray[i] / 255) * (canvas.height / dpr) * 0.8;
          
          ctx.fillStyle = `rgba(59, 130, 246, ${0.3 + (dataArray[i] / 255) * 0.7})`;
          ctx.fillRect(x, (canvas.height / dpr) - barHeight, barWidth, barHeight);
          
          x += barWidth + 1;
        }
      }
      
      draw();
    }

    function stopWaveform() {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
      
      if (audioContext) {
        audioContext.close();
      }
      
      // Clear canvas
      const canvas = document.getElementById('waveform-canvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Utility functions
    function showLoading(show) {
      const overlay = document.getElementById('loading-overlay');
      overlay.style.display = show ? 'flex' : 'none';
    }

    // Event listeners
    document.getElementById('generate-soep').addEventListener('click', generateSOEP);
    document.getElementById('whisper-btn').addEventListener('click', startRecording);
    document.getElementById('soep-recording-btn').addEventListener('click', stopRecording);
    document.getElementById('cancel-recording-btn').addEventListener('click', cancelRecording);
    
         // Auto-expanding textarea
     const textarea = document.getElementById('text-input');
     textarea.addEventListener('input', function() {
       this.style.height = 'auto';
       this.style.height = Math.min(this.scrollHeight, 200) + 'px';
     });

          // Intelligente Live Tolk (One-button smart translation)
     let tolkRecognition = null;
     let tolkConversationHistory = [];
     let isRecording = false;

     // Initialize intelligent speech recognition
     function initializeIntelligentTolk() {
       if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
         const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
         
         tolkRecognition = new SpeechRecognition();
         tolkRecognition.continuous = false;
         tolkRecognition.interimResults = true;
         tolkRecognition.lang = 'auto'; // Will be set dynamically
         
         setupTolkRecognitionEvents();
       } else {
         console.error('Speech recognition not supported');
         alert('Spraakherkenning wordt niet ondersteund in deze browser. Gebruik Chrome voor de beste ervaring.');
       }
     }

     function setupTolkRecognitionEvents() {
       tolkRecognition.onresult = function(event) {
         let transcript = '';
         for (let i = event.resultIndex; i < event.results.length; i++) {
           transcript += event.results[i][0].transcript;
         }
         
         // Update live transcript
         document.getElementById('live-transcript').innerHTML = transcript || '<span class="text-gray-400">Gesproken woorden verschijnen hier...</span>';
         
         if (event.results[event.results.length - 1].isFinal) {
           intelligentTranslateAndSpeak(transcript);
         }
       };
       
       tolkRecognition.onstart = function() {
         updateTolkStatus('Luisteren...', 'bg-green-100 text-green-600');
         isRecording = true;
       };
       
       tolkRecognition.onend = function() {
         updateTolkStatus('Klaar om te starten', 'bg-gray-100 text-gray-600');
         isRecording = false;
       };

       tolkRecognition.onerror = function(event) {
         console.error('Speech recognition error:', event.error);
         updateTolkStatus('Fout - probeer opnieuw', 'bg-red-100 text-red-600');
         isRecording = false;
       };
     }

     function updateTolkStatus(text, className) {
       const statusEl = document.getElementById('tolk-status');
       statusEl.textContent = text;
       statusEl.className = `px-4 py-2 rounded-full text-sm inline-block mb-4 ${className}`;
     }

     async function intelligentTranslateAndSpeak(spokenText) {
       updateTolkStatus('AI analyseert...', 'bg-yellow-100 text-yellow-600');
       
       try {
         const language1 = document.getElementById('language-1').value;
         const language2 = document.getElementById('language-2').value;
         
         // Send to AI for intelligent language detection and translation
         const response = await fetch('https://a2b86a9fc909.ngrok-free.app/intelligent-translate', {
           method: 'POST',
           headers: {
             'Content-Type': 'application/json',
           },
           body: JSON.stringify({
             spoken_text: spokenText,
             language_1: language1,
             language_2: language2
           })
         });
         
         const data = await response.json();
         
         if (data.error) {
           throw new Error(data.error);
         }
         
         // Display results in Dutch
         const translationOutput = document.getElementById('translation-output');
         translationOutput.innerHTML = `
           <div class="mb-3">
             <p class="text-sm text-blue-600 font-medium">Gedetecteerde taal: ${data.detected_language_name}</p>
             <p class="text-sm text-blue-600">Vertaald naar: ${data.target_language_name}</p>
           </div>
           <div class="text-blue-800 font-medium">${data.translation}</div>
         `;
         
         // Speak the translation
         speakTranslation(data.translation, data.target_language);
         
         // Add to conversation history
         addToTolkHistory(spokenText, data.translation, data.detected_language_name, data.target_language_name);
         
         updateTolkStatus('Vertaling voltooid', 'bg-green-100 text-green-600');
         
         // Reset status after 2 seconds
         setTimeout(() => {
           updateTolkStatus('Klaar om te starten', 'bg-gray-100 text-gray-600');
         }, 2000);
         
       } catch (error) {
         console.error('Intelligent translation error:', error);
         updateTolkStatus('Vertaling mislukt', 'bg-red-100 text-red-600');
         
         const translationOutput = document.getElementById('translation-output');
         translationOutput.innerHTML = '<span class="text-red-600">Er is een fout opgetreden bij de vertaling. Probeer het opnieuw.</span>';
         
         setTimeout(() => {
           updateTolkStatus('Klaar om te starten', 'bg-gray-100 text-gray-600');
         }, 3000);
       }
     }

     function speakTranslation(text, languageCode) {
       if ('speechSynthesis' in window) {
         const utterance = new SpeechSynthesisUtterance(text);
         utterance.lang = languageCode;
         utterance.rate = 0.9;
         utterance.pitch = 1;
         
         // Find voice for the language
         const voices = speechSynthesis.getVoices();
         const voice = voices.find(v => v.lang.startsWith(languageCode));
         if (voice) {
           utterance.voice = voice;
         }
         
         speechSynthesis.speak(utterance);
       }
     }

     function addToTolkHistory(original, translation, fromLang, toLang) {
       const historyItem = {
         timestamp: new Date(),
         original: original,
         translation: translation,
         fromLanguage: fromLang,
         toLanguage: toLang
       };
       
       tolkConversationHistory.push(historyItem);
       updateTolkConversationDisplay();
     }

     function updateTolkConversationDisplay() {
       const historyEl = document.getElementById('tolk-conversation-history');
       
       if (tolkConversationHistory.length === 0) {
         historyEl.innerHTML = '<div class="text-gray-500 text-center py-8">Gesprek geschiedenis verschijnt hier...</div>';
         return;
       }
       
       historyEl.innerHTML = tolkConversationHistory.map((item, index) => `
         <div class="border-l-4 border-blue-500 bg-blue-50 p-4 rounded-r-lg">
           <div class="flex justify-between items-start mb-2">
             <span class="font-medium text-blue-900">
               Gesprek ${index + 1} (${item.fromLanguage} ‚Üí ${item.toLanguage})
             </span>
             <span class="text-xs text-gray-500">${item.timestamp.toLocaleTimeString()}</span>
           </div>
           <div class="text-sm text-gray-700 mb-1"><strong>Origineel (${item.fromLanguage}):</strong> ${item.original}</div>
           <div class="text-sm text-gray-600"><strong>Vertaling (${item.toLanguage}):</strong> ${item.translation}</div>
         </div>
       `).join('');
       
       historyEl.scrollTop = historyEl.scrollHeight;
     }

     // Live conversation gets cleared automatically when session ends
     // No manual clear/export functions needed for live translator

     // Language name mappings
     const languageNames = {
       'nl': 'Nederlands',
       'en': 'English',
       'ar': 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
       'tr': 'T√ºrk√ße',
       'pl': 'Polski',
       'es': 'Espa√±ol',
       'fr': 'Fran√ßais',
       'de': 'Deutsch',
       'it': 'Italiano',
       'pt': 'Portugu√™s',
       'ru': '–†—É—Å—Å–∫–∏–π',
       'zh': '‰∏≠Êñá',
       'hi': '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä',
       'ur': 'ÿßÿ±ÿØŸà'
     };

     // Update language displays
     function updateLanguageDisplays() {
       const lang1 = document.getElementById('language-1')?.value || 'nl';
       const lang2 = document.getElementById('language-2')?.value || 'en';
       
       const doctorDisplay = document.getElementById('doctor-lang-display');
       const patientDisplay = document.getElementById('patient-lang-display');
       
       if (doctorDisplay) {
         doctorDisplay.textContent = `(${languageNames[lang1] || lang1})`;
       }
       if (patientDisplay) {
         patientDisplay.textContent = `(${languageNames[lang2] || lang2})`;
       }
     }

     // Initialize intelligent tolk when page loads
     document.addEventListener('DOMContentLoaded', function() {
       initializeIntelligentTolk();
       
       // Update language displays when selections change
       const lang1Select = document.getElementById('language-1');
       const lang2Select = document.getElementById('language-2');
       
       if (lang1Select) {
         lang1Select.addEventListener('change', updateLanguageDisplays);
       }
       if (lang2Select) {
         lang2Select.addEventListener('change', updateLanguageDisplays);
       }
       
       // Initial update
       updateLanguageDisplays();
       
       // Single record button event listeners
       const tolkBtn = document.getElementById('tolk-record-btn');
       
       if (tolkBtn) {
         // Mouse events
         tolkBtn.addEventListener('mousedown', function() {
           if (tolkRecognition && !isRecording) {
             tolkRecognition.start();
           }
         });
         
         tolkBtn.addEventListener('mouseup', function() {
           if (tolkRecognition && isRecording) {
             tolkRecognition.stop();
           }
         });
         
         // Touch events for mobile
         tolkBtn.addEventListener('touchstart', function(e) {
           e.preventDefault();
           if (tolkRecognition && !isRecording) {
             tolkRecognition.start();
           }
         });
         
         tolkBtn.addEventListener('touchend', function(e) {
           e.preventDefault();
           if (tolkRecognition && isRecording) {
             tolkRecognition.stop();
           }
         });

         // Prevent context menu on long press
         tolkBtn.addEventListener('contextmenu', function(e) {
           e.preventDefault();
         });
       }
    });
  </script>
</body>
</html>
